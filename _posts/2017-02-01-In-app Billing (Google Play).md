---
layout: post
title: In-app Billing (Google Play)
description: How to do in-app billing (Google Play) in an android device.
tags: 
    - In-app billing
    - Google Play
    - Android
---

![image alt text](/assets/images/in_app_billing/image_0.png)

![image alt text](/assets/images/in_app_billing/image_1.png)

App Account, which is managed by your API server and owns the In-App product, is different from Google Play Account, which is managed by Google Play Server and is billed for the purchase of your In-App product. That’s why one In-App product could have different status in these two servers.

<table>
  <tr>
    <td>Google Play \ API</td>
    <td>Purchased(API)</td>
    <td>Not Purchased(API)</td>
    <td>Pending(API)</td>
  </tr>
  <tr>
    <td>Purchased(GP)</td>
    <td>Purchased</td>
    <td>Consume</td>
    <td>Depends</td>
  </tr>
  <tr>
    <td>Not Purchased(GP)</td>
    <td>Purchased</td>
    <td>Not Purchased</td>
    <td>Not Purchased</td>
  </tr>
</table>


Depends on whether the Purchase Payload within Google Play Server matches the App Account:

<table>
  <tr>
    <td>Purchase Payload matched</td>
    <td>Purchased</td>
  </tr>
  <tr>
    <td>Purchase Payload NOT matched</td>
    <td>Consume</td>
  </tr>
</table>


The Consume status means you have to [consume](https://developer.android.com/google/play/billing/api.html#consume) the In-App product first. Because the same product can not be purchased twice by one Google Play Account, when different App Account(within the same GP Acct.) want to purchase the same product, you have to consume it to make it re-purchasable.

Purchase Payload is generated by API Server while the App requests a purchase. It contains some information about the purchase: App Account, Product ID, Price, last but not least. The Purchase Payload, can not be changed since created, will be stored in Google Play Server if the purchase finishes successfully. In practical, the API Server should just return a hash number to these information, which can only be known within the server.

For safety, The API Server should verify the purchase by communicating to the Google Play Server with the Purchase Payload. It’s out of the scope the this document though.

For more detail about In-App Billing, check out [here](https://developer.android.com/google/play/billing/index.html)

